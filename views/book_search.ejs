<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must0revalidate"
    />
    <meta http-equiv="Pragme" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <title>ÎèÑÏÑú Í≤ÄÏÉâ</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
      crossorigin="anonymous"
    />

    <link rel="stylesheet" href="/public/main.css" />

    <script>
      let store = "<%= now_store %>" || "yes24";
      const visibleButtons = 3;

      window.onload = function () {
        const dataSize = "<%= data ? data.length : 0 %>";
        const data = JSON.parse("<%- JSON.stringify(data) %>");
        displayData(1);
      };
      function changeStore(value) {
        store = value;
        console.log(store);
      }

      function search(event) {
        if (event.keyCode === 13) {
          console.log(store);
          const form = document.querySelector(".form");
          const inputValue = form.querySelector('input[name="value"]').value;
          const url = `/book_search?value=${inputValue}&store=${store}`;
          window.location.href = url;
        }
      }

      function remove() {
        const outputDiv = document.getElementById("output");
        while (outputDiv.firstChild) {
          outputDiv.removeChild(outputDiv.firstChild);
        }
      }

      function displayData(page) {
        const outputDiv = document.getElementById("output");
        const start = (page - 1) * 10;
        const dataSize = "<%= data ? data.length : 0 %>";
        const dataString = JSON.stringify(data);
        const data = JSON.parse(dataString);

        const end = Math.min(start + 10, dataSize, page * 10);

        remove();

        for (let i = start; i < end; i++) {
          const newDiv = document.createElement("div");
          newDiv.innerHTML = `
                    <div class="border border-white abox" style="max-width: 500px; min-width: 300px; margin: 10px auto" onclick="location.href='${data[i].link}'" data-spy="scroll" data-target="#navbar-example2" data-offset="0">

                      <button class="btn btn-outline-secondary card-t">
                      <div class="row g-2">
                      <div class="col-4"><img src="${data[i].img}" style="width: 400px" class="rounded-start img-fluid" alt="..."/></div>
                      <div class="col-8" align="left">
                      <div class="card-body">
                      <h5 class="card-title">${data[i].title}</h5>
                      <p class="card-text">${data[i].author}</p>
                      <p class="card-text">${data[i].price}</p>
                      <p class="card-text"><small class="text-muted">${data[i].marker}</small></p>
                      </div>
                      </div>
                      </div>
                      </button>
                      </div>

                      `;
          outputDiv.appendChild(newDiv);
        }

        const buttonsContainer = document.getElementById("buttons");
        buttonsContainer.innerHTML = "";
        const numPages = dataSize === 0 ? 1 : Math.ceil(dataSize / 10);
        let startButton, endButton;

        // ÌòÑÏû¨ ÌéòÏù¥ÏßÄÏóêÏÑú Î≥¥Ïùº Î≤ÑÌäº Î≤îÏúÑ Í≥ÑÏÇ∞
        if (page <= Math.ceil(visibleButtons / 2)) {
          startButton = 1;
          endButton = Math.min(numPages, visibleButtons);
        } else if (page >= numPages - Math.floor(visibleButtons / 2)) {
          startButton = Math.max(1, numPages - visibleButtons + 1);
          endButton = numPages;
        } else {
          startButton = page - Math.floor(visibleButtons / 2);
          endButton = page + Math.floor(visibleButtons / 2);
        }
        let buttonHtml = "";

        // '<<' Î≤ÑÌäº Ï∂îÍ∞Ä
        buttonHtml += `<button ${
          page === 1 ? "disabled" : ""
        } onclick="displayData(1)">&lt;&lt;</button>`;

        // '<' Î≤ÑÌäº Ï∂îÍ∞Ä
        buttonHtml += `<button ${
          page === 1 ? "disabled" : ""
        } onclick="displayData(${page - 1})">&lt;</button>`;

        // ÌéòÏù¥ÏßÄ Î≤ÑÌäº Ï∂îÍ∞Ä
        for (let i = startButton; i <= endButton; i++) {
          buttonHtml += `
            <button id="button${i}" onclick="displayData(${i})" ${
            page === i ? 'class="active"' : ""
          }>${i}</button>
          `;
        }
        // '>' Î≤ÑÌäº Ï∂îÍ∞Ä
        buttonHtml += `<button ${
          page === numPages ? "disabled" : ""
        } onclick="displayData(${page + 1})">&gt;</button>`;
        buttonHtml += `<button ${
          page === numPages ? "disabled" : ""
        } onclick="displayData(${numPages})">&gt;&gt;</button>`;

        buttonsContainer.innerHTML = buttonHtml;
      }
    </script>
    <style>
      /* ÎèÑÏÑú ÏÇ¨Ïù¥Ìä∏ Î≤ÑÌäº ÏÑ§Ï†ï*/
      .search-buttons {
        display: flex;
        justify-content: center;
      }
      .search-button {
        border: none;
        background-color: transparent;
        padding: 0;
        margin: 20px auto;
        opacity: 1;
        transition: opacity 0.3s ease-in-out;
      }
      .search-button:hover,
      .search-button:focus {
        opacity: 0.8;
      }
      .search-button:active {
        opacity: 0.6;
      }
    </style>
  </head>

  <body class="bg-main">
    <%- include('nav.html') %>

    <div class="main" style="min-width: 300px" align="center">
      <div class="wrapper">
        <div class="form-group has-search" style="max-width: 500px">
          <h3><%= now_keyword %></h3>

          <form class="form">
            <input
              required
              maxlength="10"
              type="text"
              class="form-control card-t"
              name="value"
              placeholder="Search"
              onkeydown="search(event)"
            />
          </form>

          <button type="submit" form="todo-form" style="display: none">
            Ï†úÏ∂úÌïòÍ∏∞
          </button>

          <div class="search-buttons" style="display: flex" align="center">
            <button
              class="search-button yes24"
              data-site="yes24"
              onclick="changeStore('yes24')"
            >
              <img
                src="/public/image/yes24.jpg"
                alt="ÏòàÏä§24"
                width="100"
                height="40"
              />
            </button>

            <button
              class="search-button aladin"
              data-site="aladin"
              onclick="changeStore('aladin')"
            >
              <img
                src="/public/image/aladin.jpg"
                alt="ÏïåÎùºÎîò"
                width="100"
                height="40"
              />
            </button>

            <button
              class="search-button kyobo"
              data-site="kyobo"
              onclick="changeStore('kyobo')"
            >
              <img
                src="/public/image/kyobo.jpg"
                alt="ÍµêÎ≥¥Î¨∏Í≥†"
                width="100"
                height="40"
              />
            </button>
          </div>

          <div class="todo-inner" style="color: #0c0b0b">
            <div class="">
              <h4 class="tit">ÏµúÍ∑º Í≤ÄÏÉâÏñ¥</h4>
              <span class="btn allDelete off" style="background-color: #8c8c8c"
                >Ï†ÑÏ≤¥ÏÇ≠Ï†úüóëÔ∏è</span
              >
            </div>
            <p class="txt"></p>
            <ul id="todo-list" style="display: flex"></ul>
          </div>
        </div>
      </div>

      <!-- 1) Í∏∞ÌÉÄ Ï±ÖÏùÄ 10Í∞ú Ïù¥ÌïòÎ°ú Îì±Î°ùÎêòÏñ¥ 10Í∞úÎ°ú ÏßúÎ•º Ïàò ÏóÜÎäî Í≤ΩÏö∞Í∞Ä ÏÉùÍ≤®ÏÑú ÏòàÏô∏Ï≤òÎ¶¨Í∞Ä ÌïÑÏöîÌñàÎã§.-->
      <div id="output">
        <div>
          <% for (var i=0; i < Math.min(data.length, 10); i++) { %>

          <div
            class="border border-white abox tbox"
            style="max-width: 500px; margin: 10px auto"
            onclick="location.href='http:<%=data[i].link %>'"
            data-spy="scroll"
            data-target="#navbar-example2"
            data-offset="0"
          >
            <div class="row g-2 card-t">
              <div class="col-4">
                <img
                  src="<%=data[i].img %>"
                  class="rounded-start img-fluid"
                  alt="..."
                />
              </div>
              <div class="col-8" align="left">
                <div class="card-body">
                  <h5 class="card-title"><%=data[i].title%></h5>
                  <p class="card-text"><%=data[i].author%></p>
                  <p class="card-text"><%=data[i].price%>Ïõê</p>
                  <p class="card-text">
                    <small class="text-muted"> <%=now_store%> </small>
                  </p>
                </div>
              </div>
            </div>
          </div>
          <figuercaption> click </figuercaption>
          <% } %>
        </div>
      </div>
    </div>

    <div id="buttons"></div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
      crossorigin="anonymous"
    ></script>

    <!-- Load jquery -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>

    <script src="/public/scripts/save_search.js"></script>

    <script>
      var nowKeyword = "<%= now_keyword %>";
    </script>
  </body>
</html>
